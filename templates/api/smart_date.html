{% extends "api/api_layout.html" %}
{% block content %}
<h2>smart_date</h2>
<p>Православное API использует для вычисления даты календаря решение smart_date. Это набор инструментов позволяющий переводить строковое описание событий (формула дня) в массив дат формата YYYY-mm-dd.</p>
<div class='row'>
<div class='span8'>
    <code>smart_date_function($formula, $year);</code>
    <p><b>INPUT</b><br/>
        $formula - Формула по которой будет выполнен поиск дат (обязательный)<br/>
        $year    - Год, для которого будет выполнен поиск
    </p>
    <p>
    <b>OUTPUT</b>
        array    - Массив, каждый элемент которого также массив из трёх элементов
                   [0] - день, [1] - месяц, [2] - год.
                   Массив отсортирован по возрастанию.
    </p>

    <p>Формула состоит из 3-х полей отделённых друг от друга символом "|".</p>
    <code>[поле дат|фильтр дня недели|фильтр данных]</code>
    <ol>
    <li><b>Поле дат</b></li>
        <ol>
        <li>
            Даты задаются в формате ДД.ММ.ГГГГ. Если поле ГГГГ опущено,
            то считается, что оно равно текущему году.
        </li>
        <li>Даты задаются в виде перечисления или интервала.</li>
            <ol>
            <li>
                Перечисление - несколько дат, с запятой между ними.<br/>
                <code>12.03.2011,14.04.2010,17.05</code>
            </li>
            <li>
                Интервал - задаётся в виде "начальная дата"~"конечная дата".<br/>
                <code>12.04.2001~22.04.2001</code>
            </li>
            <li>
                Возможна комбинация из перечисления и интервала.<br/>
                <code>21.10,22.11~5.12,15.12</code>
            </li>
            </ol>
        <li>В поле дат может стоять формула. В этом случае сначала вычисляется
            она, затем результат её вычисления подставляется
            в исходную формулу. Уровень вложенности формул неограничен.<br/>
            <code>[12.03,[14.01~14.02|1110001|-1,-2]|1110001|1,2,3]</code>
        </li>
        <li>Вместо даты или интервала можно подставить функцию.
            Встроенная функция оформляется внутри фигурных скобок.
            В качестве аргумента функции может указываться год, для готорого
            она вызывается. Если год не указан, то тогда он считается равным
            $year. Регистр не важен.<br/>
            <code>
            [{B}~01.02||]=[01.01~01.02]<br/>
            [{be(1927)}||]=[01.01.1927~31.12.1927||]<br/>
            [{Pascha(2012)}||] - Православная прасха в 2012 году.<br/>
            </code>
        </li>
        <li>Смещение дат
            <ol>
                <li>Смещение года. Если в дате год указан со знаком "+" или "-"
            то он интерпретируется не как год,
            а как смещение относительно года $year.<br/>
                <code>
                  13.10.-10 = 13.10.2001 ($year=2011)<br/>
                  21.12.+7  = 21.12.2018 ($year=2011)
                </code>
                </li>
                <li>Смещение дней. Если дата начинается с "число>" или "число<"
                  то такая дата сдвигается вперед по времени (">")
                  или назад по времени ("<") на "число" дней. "Число" может
                  быть отрицательным.<br/>
                  <code>
                  12>29.12.2001 = -12<29.12.2001 = 10.01.2002<br/>
                  2<1.11.1876 = -2>1.11.1876 = 30.10.1876
                  </code>
                </li>
                </ol>
        </li>
        </ol>
    <li><b>Фильтр дня недели</b></li>
       Фильтр может состоять из 7-ми символов "0" и "1" или быть пустым.
       Если фильтр не задан, то считается, что он равен "1111111".
       Фильтр указывает какие дни недели нужно оставить в выборке дат.
       Символы идут в порядке - "пн", "вт", - , "вс".<br/>
       <code>0110000 - оставить в выборке только вторники и среды.</code>

    <li><b>Фильтр данных</b></li>
       Фильтр определяет какие данные оставить, в зависимости от того,
       на каком месте в выборке они находятся. "0" - оставить всё.
       Отрицательные числа определяют какие данные оставить с конца выборки.<br/>
       <code>
       1,-1 - оставить первую и последнюю дату.<br/>
       0 - оставить все даты.
       </code>
    </ol>
</div>
<div class='span4'>
<h4>Примеры формул:</h4>
<dl>
    <dt class="text-info">{BE(2001)},{BE}|1000000</dt><dd>все понедельники за текущий и 2001 год</dd>
    <dt class="text-info">01.05~31.05|0000001|-1</dt> <dd> последнее воскресенье мая</dd>
    <dt class="text-info">{Pascha(2012)}</dt> <dd> Православная прасха в 2012 году.</dd>
    <dt class="text-info">36<{Pascha},29<{Pascha},22<{Pascha}</dt><dd>родительские вселенские субботы</dd>
    <dt class="text-info">69<{Pascha}~63<{Pascha}</dt> <dd>седмица Мытаря и фарисея</dd>
    <dt class="text-info">02.11~08.11|0000010</dt><dd> дмитровская суббота</dd>
</dl>
</div>
</div>
<h4>Использование модуля smart_date отдельно</h4>
<div class='row'>
  <div class='span6'>
    <h4> PHP </h4>
    Конфигурация для composer
      <pre>
"require": {
    "php": ">=5.3.0",
    "Sancta/SmartDate": "dev-master"
},
"repositories":[
  {
      "type": "git",
      "url": "http://github.com/Ravall/smartDate"
  }
],</pre>
    использование в проекте:<br/>
    <pre>
require_once 'path/to/composer/autoload.php';
use SmartDate\DateFunction;
$x = DateFunction::run('11.11~15.11');
    </pre>
    <hr/>
    использование без composer<br>
    загрузить из git (<a href='http://github.com/Ravall/smartDate'>http://github.com/Ravall/smartDate</a>)<br/>
    <pre>
require 'path/to/DateFunction.php';
use SmartDate;
# как фунции
SmartDate\smart_date_function('11.11~15.11');
# как статический метод класса
SmartDate\DateFunction::run('11.11~15.11'));
 </pre>

  </div>
  <div class='span6'>
    <h4>Python</h4>
    Установка:
    <pre>
pip install smart_date
    </pre>
    Использование:
    <pre>
from smart_date.smartfunction import smart_function
print smart_function('11.01', 2013)
    </pre>
    <p>Так же рекомендуется изучить все методы пакета, код тестов, входящих для понимания целостной структуры проекта.<br/>

    <a href='https://github.com/Ravall/smart_date'>http://github.com/Ravall/smart_date</a></p>
  </div>
</div>

{% endblock content %}
